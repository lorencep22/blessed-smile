<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patients List</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
</head>

<body style="height: 100%;" id="patients-page">

    <div class="container mt-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>Patients</h2>
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#patientModal">
                Add Patient
            </button>
        </div>
        <div id="patientsList"></div>
        <!-- Modal -->
        <div class="modal fade" id="patientModal" tabindex="-1" aria-labelledby="patientModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="patientModalLabel">Patient Details</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="modalBody">
                        <!-- Dynamic content goes here -->
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/public/app.js" defer></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Generate patient form inside modal
            const modalBody = document.getElementById('modalBody');

            modalBody.innerHTML = `
                            <form id="addPatientForm">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="firstName" class="form-label">First Name</label>
                                            <input type="text" class="form-control" id="firstName" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="middleName" class="form-label">Middle Name</label>
                                            <input type="text" class="form-control" id="middleName">
                                        </div>
                                        <div class="mb-3">
                                            <label for="lastName" class="form-label">Last Name</label>
                                            <input type="text" class="form-control" id="lastName" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="sex" class="form-label">Gender</label>
                                            <select class="form-select" id="sex" required>
                                                <option value="">Select</option>
                                                <option value="Male">Male</option>
                                                <option value="Female">Female</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label for="contactNo" class="form-label">Contact No.</label>
                                            <input type="text" class="form-control" id="contactNo" required>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="email" class="form-label">Email</label>
                                            <input type="email" class="form-control" id="email" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="address" class="form-label">Address</label>
                                            <input type="text" class="form-control" id="address">
                                        </div>
                                        <div class="mb-3">
                                            <label for="birthday" class="form-label">Birthday</label>
                                            <input type="date" class="form-control" id="birthday">
                                        </div>
                                        <div class="mb-3">
                                            <label for="occupation" class="form-label">Occupation</label>
                                            <input type="text" class="form-control" id="occupation">
                                        </div>
                                        <div class="mb-3">
                                            <label for="civilStatus" class="form-label">Civil Status</label>
                                            <select class="form-select" id="civilStatus">
                                                <option value="">Select</option>
                                                <option value="Single">Single</option>
                                                <option value="Married">Married</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary w-100">Submit</button>
                            </form>
                        `;

            // Confirmation and submit logic
            const addPatientForm = document.getElementById('addPatientForm');
            addPatientForm.onsubmit = function (e) {
                e.preventDefault();
                if (confirm('Are you sure you want to submit this new patient?')) {
                    const patient = {
                        firstName: document.getElementById('firstName').value,
                        middleName: document.getElementById('middleName').value,
                        lastName: document.getElementById('lastName').value,
                        sex: document.getElementById('sex').value,
                        contactNo: document.getElementById('contactNo').value,
                        email: document.getElementById('email').value,
                        address: document.getElementById('address').value,
                        birthday: document.getElementById('birthday').value,
                        occupation: document.getElementById('occupation').value,
                        civilStatus: document.getElementById('civilStatus').value
                    };
                    // Use global patientDetailsCollection from app.js
                    if (window.patientDetailsCollection) {
                        window.patientDetailsCollection.add(patient)
                            .then(() => {
                                alert('Patient added successfully!');
                                document.getElementById('addPatientForm').reset();
                                // Hide modal
                                const modal = bootstrap.Modal.getOrCreateInstance(document.getElementById('patientModal'));
                                modal.hide();
                                // Optionally, reload the page or refresh the patient list
                                location.reload();
                            })
                            .catch((error) => {
                                alert('Error adding patient: ' + error);
                            });
                    }
                }
            };
        });
    </script>
</body>

</html>