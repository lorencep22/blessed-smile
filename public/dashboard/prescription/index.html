<html lang="en">

<head>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <!-- jsPDF and jsPDF-AutoTable for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prescription List</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="../theme/theme-variables.css" rel="stylesheet">
    <link href="../theme/theme-immediate.css" rel="stylesheet">

    <!-- Critical CSS - Apply theme immediately before any rendering -->
    <script>
        (function () {
            const savedTheme = localStorage.getItem('blessedsmile-theme');
            if (savedTheme) {
                const themes = {
                    gold: { bg: 'linear-gradient(135deg, #fff 0%, #ffd700 50%, #fff 100%)', text: '#000', isDark: false },
                    blue: { bg: 'linear-gradient(135deg, #e3f2fd 0%, #007bff 50%, #e3f2fd 100%)', text: '#1a1a1a', isDark: false },
                    green: { bg: 'linear-gradient(135deg, #e8f5e8 0%, #28a745 50%, #e8f5e8 100%)', text: '#1a1a1a', isDark: false },
                    purple: { bg: 'linear-gradient(135deg, #f3e5f5 0%, #6f42c1 50%, #f3e5f5 100%)', text: '#1a1a1a', isDark: false },
                    dark: { bg: 'linear-gradient(135deg, #1a202c 0%, #2d3748 50%, #1a202c 100%)', text: '#fff', isDark: true },
                    midnight: { bg: 'linear-gradient(135deg, #0f1419 0%, #1a365d 50%, #0f1419 100%)', text: '#e2e8f0', isDark: true }
                };
                const theme = themes[savedTheme];
                if (theme) {
                    document.documentElement.style.background = theme.bg;
                    const style = document.createElement('style');
                    style.innerHTML = `html, body { background: ${theme.bg} !important; color: ${theme.text} !important; transition: none !important; }`;
                    document.head.appendChild(style);
                    document.documentElement.className = theme.isDark ? 'theme-dark' : 'theme-light';
                }
            }
        })();
    </script>

    <script src="../theme/theme-immediate.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="../theme/theme-manager.js" defer></script>
    <script src="../theme/theme-communication.js" defer></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
    <!-- Google Fonts for Roboto and Montserrat -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700&display=swap" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.7/quill.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/quill-image-resize-module@3.0.0/image-resize.min.js"></script>

    <style>
        /* Show correct font names in Quill font dropdown */
        .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="sans-serif"]::before,
        .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="sans-serif"]::before {
            content: "Sans Serif";
        }

        .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="arial"]::before,
        .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="arial"]::before {
            content: "Arial";
        }

        .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="timesnewroman"]::before,
        .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="timesnewroman"]::before {
            content: "Times New Roman";
        }

        .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="roboto"]::before,
        .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="roboto"]::before {
            content: "Roboto";
        }

        .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="montserrat"]::before,
        .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="montserrat"]::before {
            content: "Montserrat";
        }

        body {
            background: var(--theme-background);
            color: var(--theme-text);
            background-size: 100% 100%;
            background-repeat: no-repeat;
            background-attachment: fixed;
            min-height: 100vh;
        }

        /* Hide page content until theme is fully loaded */
        body.theme-loading .container {
            opacity: 0;
            transition: opacity 0.3s ease-in;
        }

        body:not(.theme-loading) .container {
            opacity: 1;
            transition: opacity 0.3s ease-in;
        }

        .container {
            background: var(--theme-card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px var(--theme-shadow);
        }

        h2 {
            color: var(--theme-text);
            font-weight: 600;
        }

        .btn-primary {
            background: var(--theme-primary-bg);
            border: 2px solid var(--theme-accent);
            color: var(--theme-text);
            font-weight: 600;
            box-shadow: 0 2px 8px var(--theme-shadow), 0 1.5px 0 var(--theme-surface) inset;
            border-radius: 6px;
        }


        #editor .ql-editor {
            scrollbar-width: none;
            /* Firefox */
            -ms-overflow-style: none;
            /* IE 10+ */
        }

        #editor .ql-editor::-webkit-scrollbar {
            display: none;
            /* Chrome, Safari, Opera */
        }

        #editor .ql-editor img {
            cursor: grab;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        .btn-primary:hover {
            background: var(--theme-accent);
            border-color: var(--theme-accent);
            color: var(--theme-text);
            transform: translateY(-2px) scale(1.01);
            box-shadow: 0 6px 16px var(--theme-shadow), 0 1.5px 0 var(--theme-surface) inset;
        }

        .nav-tabs .nav-link {
            color: var(--theme-text);
            border: 1px solid var(--theme-accent);
            background: var(--theme-surface);
        }

        .nav-tabs .nav-link:hover {
            background: var(--theme-hover);
            border-color: var(--theme-accent);
            color: var(--theme-text);
        }

        .nav-tabs .nav-link.active {
            background: var(--theme-accent);
            border-color: var(--theme-accent);
            color: var(--theme-text);
            font-weight: 600;
        }

        #prescriptionModal .modal-body .mb-2 div[style*='font-size:14px;'] {
            line-height: 1.2;
        }

        /* Change cursor to grab hand when hovering over images in Quill editor */
        #editor .ql-editor img {
            cursor: grab;
        }

        /* Custom font styles for Quill */
        .ql-font-arial {
            font-family: Arial, Helvetica, sans-serif;
        }

        .ql-font-timesnewroman {
            font-family: 'Times New Roman', Times, serif;
        }

        .ql-font-roboto {
            font-family: 'Roboto', Arial, sans-serif;
        }

        .ql-font-montserrat {
            font-family: 'Montserrat', Arial, sans-serif;
        }

        /* Show pixel values in Quill size dropdown */
        .ql-snow .ql-picker.ql-size .ql-picker-label[data-value="10px"]::before,
        .ql-snow .ql-picker.ql-size .ql-picker-item[data-value="10px"]::before {
            content: "10px";
        }

        .ql-snow .ql-picker.ql-size .ql-picker-label[data-value="12px"]::before,
        .ql-snow .ql-picker.ql-size .ql-picker-item[data-value="12px"]::before {
            content: "12px";
        }

        .ql-snow .ql-picker.ql-size .ql-picker-label[data-value="14px"]::before,
        .ql-snow .ql-picker.ql-size .ql-picker-item[data-value="14px"]::before {
            content: "14px";
        }

        .ql-snow .ql-picker.ql-size .ql-picker-label[data-value="16px"]::before,
        .ql-snow .ql-picker.ql-size .ql-picker-item[data-value="16px"]::before {
            content: "16px";
        }

        .ql-snow .ql-picker.ql-size .ql-picker-label[data-value="18px"]::before,
        .ql-snow .ql-picker.ql-size .ql-picker-item[data-value="18px"]::before {
            content: "18px";
        }

        .ql-snow .ql-picker.ql-size .ql-picker-label[data-value="24px"]::before,
        .ql-snow .ql-picker.ql-size .ql-picker-item[data-value="24px"]::before {
            content: "24px";
        }

        .ql-snow .ql-picker.ql-size .ql-picker-label[data-value="32px"]::before,
        .ql-snow .ql-picker.ql-size .ql-picker-item[data-value="32px"]::before {
            content: "32px";
        }

        .ql-snow .ql-picker.ql-size .ql-picker-label:not([data-value]),
        .ql-snow .ql-picker.ql-size .ql-picker-item:not([data-value]) {
            content: "Default";
            /* display: none; */
        }

        #ql-picker-options-1>span.ql-picker-item.ql-selected {
            display: none;
        }

        #editor {
            min-height: 500px;
            transition: height 0.2s ease;
        }

        /* Print/PDF specific styles - force black text and white background */
        @media print {
            * {
                color: #000 !important;
                background-color: #fff !important;
                background: #fff !important;
            }

            body,
            html {
                background: #fff !important;
                color: #000 !important;
            }

            .ql-editor,
            .ql-editor * {
                color: #000 !important;
                background: #fff !important;
            }

            input,
            textarea {
                color: #000 !important;
                background: #fff !important;
                border-color: #000 !important;
            }
        }

        /* PDF export specific styles */
        .pdf-export * {
            color: #000 !important;
            background-color: #fff !important;
            background: #fff !important;
        }

        .pdf-export body,
        .pdf-export html,
        .pdf-export .ql-editor,
        .pdf-export .ql-editor * {
            color: #000 !important;
            background: #fff !important;
        }

        .pdf-export input,
        .pdf-export textarea {
            color: #000 !important;
            background: transparent !important;
            background-color: transparent !important;
            border: none !important;
            border-bottom: 1px solid #000 !important;
        }

        .pdf-export input[type="date"],
        .pdf-export input[type="text"],
        .pdf-export textarea {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        /* Comprehensive PDF export styles for all prescription elements */
        .pdf-export #prescription *,
        .pdf-export #certificate *,
        .pdf-export #medicalClearance *,
        .pdf-export #dentalCaseReport * {
            color: #000 !important;
            background: #fff !important;
            background-color: #fff !important;
        }

        .pdf-export .fw-bold,
        .pdf-export .text-center,
        .pdf-export .text-left,
        .pdf-export .text-end,
        .pdf-export label,
        .pdf-export span,
        .pdf-export div,
        .pdf-export p,
        .pdf-export strong,
        .pdf-export em,
        .pdf-export i,
        .pdf-export b {
            color: #000 !important;
        }

        .pdf-export h1,
        .pdf-export h2,
        .pdf-export h3,
        .pdf-export h4,
        .pdf-export h5,
        .pdf-export h6 {
            color: #000 !important;
        }

        /* Force all text content to be black regardless of theme or inline styles */
        .pdf-export * {
            color: #000 !important;
        }

        /* Ensure container backgrounds are white */
        .pdf-export .container,
        .pdf-export .row,
        .pdf-export .col-8,
        .pdf-export .col-4,
        .pdf-export .col-12 {
            background: #fff !important;
            background-color: #fff !important;
        }

        /* Responsive Design - Page Structure Only */

        /* Mobile First Approach - Base styles for mobile */
        .page-header {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            align-items: stretch;
            margin-bottom: 1rem;
        }

        .header-title {
            text-align: center;
            margin-bottom: 0.5rem;
        }

        .header-actions {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            width: 100%;
        }

        /* Container padding adjustments for smaller screens */
        .container {
            padding: 1rem;
            margin: 0.5rem;
            max-width: calc(100% - 1rem);
        }

        /* Document containers - maintain layout but add responsive wrapper */
        .document-wrapper {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .document-content {
            min-width: 600px;
            /* Minimum width to preserve document layout */
        }

        /* Tab navigation responsive */
        .nav-tabs {
            flex-wrap: nowrap;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .nav-tabs .nav-link {
            white-space: nowrap;
            font-size: 0.875rem;
            padding: 0.5rem 0.75rem;
        }

        /* Quill editor responsive wrapper */
        .editor-wrapper {
            width: 100%;
            overflow: hidden;
        }

        #editor {
            width: 100%;
            min-width: 0;
        }

        /* Small devices (landscape phones, 576px and up) */
        @media (min-width: 576px) {
            .container {
                padding: 1.5rem;
                margin: 1rem auto;
                max-width: 540px;
            }

            .header-actions {
                flex-direction: row;
                flex-wrap: wrap;
                gap: 0.75rem;
            }

            .nav-tabs .nav-link {
                font-size: 1rem;
                padding: 0.75rem 1rem;
            }

            .document-content {
                min-width: 650px;
            }
        }

        /* Medium devices (tablets, 768px and up) */
        @media (min-width: 768px) {
            .container {
                max-width: 720px;
                padding: 2rem;
            }

            .page-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }

            .header-title {
                text-align: left;
                margin-bottom: 0;
            }

            .header-actions {
                flex-direction: row;
                width: auto;
                justify-content: flex-end;
                flex-wrap: wrap;
            }

            .nav-tabs {
                overflow-x: visible;
            }

            .document-content {
                min-width: 700px;
            }
        }

        /* Large devices (desktops, 992px and up) */
        @media (min-width: 992px) {
            .container {
                max-width: 960px;
            }

            .document-wrapper {
                overflow-x: visible;
            }

            .document-content {
                min-width: auto;
                width: 100%;
                max-width: 800px;
                margin: 0 auto;
            }
        }

        /* Extra large devices (large desktops, 1200px and up) */
        @media (min-width: 1200px) {
            .container {
                max-width: 1140px;
            }

            .document-content {
                max-width: 850px;
            }
        }

        /* Extra extra large devices (1400px and up) */
        @media (min-width: 1400px) {
            .container {
                max-width: 1320px;
            }

            .document-content {
                max-width: 900px;
            }
        }

        /* Touch device optimizations */
        @media (hover: none) and (pointer: coarse) {
            .btn {
                padding: 0.75rem 1rem;
                font-size: 1rem;
                min-height: 44px;
                touch-action: manipulation;
            }

            .nav-tabs .nav-link {
                min-height: 44px;
                display: flex;
                align-items: center;
                touch-action: manipulation;
            }

            .form-control {
                padding: 0.75rem;
                font-size: 1rem;
                min-height: 44px;
                touch-action: manipulation;
            }
        }

        /* Responsive button sizes */
        .btn-responsive {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        @media (min-width: 768px) {
            .btn-responsive {
                padding: 0.625rem 1.25rem;
                font-size: 1rem;
            }
        }

        /* Ensure proper spacing on mobile */
        .gap-responsive {
            gap: 0.5rem;
        }

        @media (min-width: 576px) {
            .gap-responsive {
                gap: 0.75rem;
            }
        }

        @media (min-width: 768px) {
            .gap-responsive {
                gap: 1rem;
            }
        }

        /* Editor wrapper for Quill */
        .editor-wrapper {
            width: 100%;
            overflow-x: auto;
        }

        @media (max-width: 768px) {
            .editor-wrapper #editor {
                height: 400px !important;
            }
        }

        @media (max-width: 576px) {
            .editor-wrapper #editor {
                height: 350px !important;
            }
        }

        /* Make sure doctor names and license info are black */
        .pdf-export .doctor-print-bold {
            color: #000 !important;
        }

        /* Force Quill editor content to be black with white background */
        .pdf-export #editor,
        .pdf-export .ql-container,
        .pdf-export .ql-container.ql-snow,
        .pdf-export .ql-editor,
        .pdf-export .ql-editor p,
        .pdf-export .ql-editor div,
        .pdf-export .ql-editor span,
        .pdf-export .ql-editor strong,
        .pdf-export .ql-editor em,
        .pdf-export .ql-editor * {
            color: #000 !important;
            background: #fff !important;
            background-color: #fff !important;
        }

        /* Override any theme colors for the editor container during PDF export */
        .pdf-export #editor {
            background: #fff !important;
            background-color: #fff !important;
        }

        /* Quill toolbar styling for dark theme */
        .theme-dark .ql-toolbar.ql-snow {
            background: var(--theme-card-bg);
            border-color: var(--theme-accent);
        }

        .theme-dark .ql-toolbar.ql-snow .ql-stroke {
            stroke: #fff !important;
        }

        .theme-dark .ql-toolbar.ql-snow .ql-fill {
            fill: #fff !important;
        }

        .theme-dark .ql-toolbar.ql-snow .ql-picker-label {
            color: #fff !important;
        }

        .theme-dark .ql-toolbar.ql-snow .ql-picker-options {
            background: var(--theme-card-bg);
            border-color: var(--theme-accent);
        }

        .theme-dark .ql-toolbar.ql-snow .ql-picker-item {
            color: #fff !important;
        }

        .theme-dark .ql-toolbar.ql-snow .ql-picker-item:hover {
            background: var(--theme-hover);
        }

        .theme-dark .ql-toolbar.ql-snow button:hover,
        .theme-dark .ql-toolbar.ql-snow button.ql-active {
            background: var(--theme-hover);
        }

        .theme-dark .ql-toolbar.ql-snow button:hover .ql-stroke,
        .theme-dark .ql-toolbar.ql-snow button.ql-active .ql-stroke {
            stroke: var(--theme-accent) !important;
        }

        .theme-dark .ql-toolbar.ql-snow button:hover .ql-fill,
        .theme-dark .ql-toolbar.ql-snow button.ql-active .ql-fill {
            fill: var(--theme-accent) !important;
        }

        /* Force black text in Quill editor regardless of theme */
        #editor .ql-editor,
        #editor .ql-editor * {
            color: #000 !important;
            background-color: white !important;
        }

        #editor .ql-container.ql-snow {
            background: #fff;
        }
    </style>
</head>

<body style="height: 100%;" id="patients-page" class="theme-loading">

    <div class="container mt-5">
        <div class="page-header gap-responsive">
            <h2 class="header-title">Documents</h2>
            <div class="header-actions gap-responsive">
                <button type="button" class="btn btn-primary btn-responsive" id="printPrescriptionBtn">
                    Save Prescription
                </button>
                <button type="button" class="btn btn-primary btn-responsive" id="printCertificateBtn"
                    style="display:none;">
                    Save Certificate
                </button>
                <button type="button" class="btn btn-primary btn-responsive" id="printMedicalClearanceBtn"
                    style="display:none;">
                    Save Medical Clearance
                </button>
                <button type="button" class="btn btn-primary btn-responsive" id="printCaseReportBtn"
                    style="display:none;">
                    Save Case Report
                </button>
            </div>
        </div>
    </div>
    <!-- tabs -->
    <div class="container">
        <ul class="nav nav-tabs" id="prescriptionTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="all-prescriptions-tab" data-bs-toggle="tab"
                    data-bs-target="#all-prescriptions" type="button" role="tab" aria-controls="all-prescriptions"
                    aria-selected="true">Dental Prescriptions</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="recent-prescriptions-tab" data-bs-toggle="tab"
                    data-bs-target="#recent-prescriptions" type="button" role="tab" aria-controls="recent-prescriptions"
                    aria-selected="false">Dental Certificate</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="medical-clearance-tab" data-bs-toggle="tab"
                    data-bs-target="#medical-clearance" type="button" role="tab" aria-controls="medical-clearance"
                    aria-selected="false">Medical Clearance</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="dental-case-report-tab" data-bs-toggle="tab"
                    data-bs-target="#dental-case-report" type="button" role="tab" aria-controls="dental-case-report"
                    aria-selected="false">Dental Case
                    Report</button>
            </li>
        </ul>
        <div class="tab-content mt-3" id="prescriptionTabsContent">
            <div class="tab-pane fade show active" id="all-prescriptions" role="tabpanel"
                aria-labelledby="all-prescriptions-tab">
                <div id="allPrescriptionsList" class="mb-64">
                    <div class="document-wrapper">
                        <div id="prescription" class="document-content" style="max-width:700px; margin: 0 auto;">
                            <div class="row">
                                <div class="col-8">
                                    <div class="mb-2">
                                        <div id="doctorContainer">
                                            <div>
                                                <div class="col-7 text-left">
                                                    <div style="font-family:serif; font-size:1.3rem; font-weight:bold;">
                                                        Kristine
                                                        Mae
                                                        Felipe,
                                                        DMD</div>
                                                </div>
                                                <div class="col-7 text-left">
                                                    <div style="font-family:serif; font-size:1.3rem; font-weight:bold;">
                                                        Ronald
                                                        O.
                                                        Felipe,
                                                        DMD</div>
                                                </div>
                                            </div>
                                        </div>
                                        <span class="fw-bold">DENTISTRY</span>
                                        <div style="font-size:14px;">
                                            General Dentistry, Prosthodontics, Endodontics, Surgery, Orthodontics<br>
                                            Member, Philippine Dental Association<br>
                                            Member, Quezon City Dental Chapter, Inc<br>
                                            Member, Philippine Prosthodontic Society<br>
                                            Member, Philippine Endodontic Society
                                        </div>

                                    </div>
                                </div>
                                <div class="col-4 text-end">
                                    <img src="/site-logo.png" alt="Blessed Smile Logo"
                                        style="width:120px; margin-bottom:4px;">
                                    <div class="fw-bold" style="margin-bottom:2px;">Blessed Smile<br><span
                                            style="font-size:16px;">Dental
                                            Clinic</span></div>
                                    <div style="font-size:12px; margin-bottom:0;">EST. 2005</div>
                                </div>
                            </div>
                            <div class="row mt-3 mb-2">
                                <div class="col-8">
                                    <div class="mb-2" style="display: flex; gap: 5px;">
                                        <label for="patientName" class="form-label mb-1"
                                            style="font-weight: 500;">Patient's
                                            Name: </label>
                                        <input class="form-control" type="text" name="" id="patientName"
                                            list="patientNamesDatalist"
                                            style="max-width: 220px; height: 28px; font-size: 0.95rem;">
                                    </div>
                                    <div class="mb-2" style="display: flex; gap: 5px;">
                                        <label for="patientAddress" class="form-label mb-1 "
                                            style="font-weight: 500;">Address:
                                        </label>
                                        <input class="form-control" type="text" name="" id="patientAddress"
                                            style="max-width: 220px; height: 28px; font-size: 0.95rem;">
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="mb-2" style="display: flex; gap: 5px;">
                                        <label for="date" class="form-label mb-1"
                                            style="font-weight: 500;">Date:</label>
                                        <input class="form-control" type="date" name="" id="date"
                                            style="height: 28px; font-size: 0.95rem;">
                                    </div>
                                    <div class="mb-2" style="display: flex; gap: 5px;">
                                        <label for="age" class="form-label mb-1" style="font-weight: 500;">Age:</label>
                                        <input class="form-control" type="text" name="" id="age"
                                            style="max-width: 50px; text-align: center; height: 28px; font-size: 0.95rem;">
                                    </div>
                                </div>
                            </div>
                            <div class="row mb-4">
                                <div class="col-12">
                                    <div class="fs-1 fw-bold" style="font-family:serif;"><img src="/rx-logo.svg" alt=""
                                            style="max-height: 50px;"></div>
                                    <div style="display: flex; align-items: center; gap: 5px; padding: 0 50px;"
                                        id="rxContainer">
                                        <img src="/sig.png" alt="" style="width: 80px;">
                                        <textarea class="form-control mt-2" rows="2"
                                            placeholder="Prescription details..."></textarea>
                                    </div>
                                    <div style="display: flex; justify-content: center; margin-top: 12px;"
                                        id="addPrescriptionContainer">
                                        <button class="btn btn-dark btn-sm px-3 py-1" style="font-size: 0.95rem;">Add
                                            Prescription</button>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-5">
                                <div id="doctorSignatureRow"
                                    style="display: flex; justify-content: center; gap: 60px; margin-bottom: 18px;">
                                    <div style="text-align: center; min-width: 220px;">
                                        <div style="font-family:serif; font-size:1.3rem; font-weight:bold;">Kristine Mae
                                            Felipe, DMD</div>
                                        <div style="font-size:15px; margin-top:4px;">LICENSE NO. : 47494</div>
                                        <div style="font-size:15px; margin-top:2px;">PTR NO.</div>
                                    </div>
                                    <div style="text-align: center; min-width: 220px;">
                                        <div style="font-family:serif; font-size:1.3rem; font-weight:bold;">Ronald O.
                                            Felipe, DMD</div>
                                        <div style="font-size:15px; margin-top:4px;">LICENSE NO. : 46872</div>
                                        <div style="font-size:15px; margin-top:2px;">PTR NO.</div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-4">
                                <div class="col-12 text-center" style="font-size:15px;  margin-bottom: 50px;">
                                    <span class="fw-bold">Contact #:</span> 09209548773 / 09298031380<br>
                                    <span class="fw-bold">Email:</span> blessedsmiledentalclinic@gmail.com
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="recent-prescriptions" role="tabpanel"
                aria-labelledby="recent-prescriptions-tab">
                <div id="certificateTemplate">
                    <div class="document-wrapper">
                        <div id="certificate" class="document-content" style="max-width:700px; margin: 0 auto;">
                            <div class="row">
                                <div class="col-8">
                                    <div class="mb-2">
                                        <div>
                                            <div class="col-7 text-left">
                                                <div style="font-family:serif; font-size:1.3rem; font-weight:bold;">
                                                    Kristine
                                                    Mae
                                                    Felipe,
                                                    DMD</div>
                                            </div>
                                            <div class="col-7 text-left">
                                                <div style="font-family:serif; font-size:1.3rem; font-weight:bold;">
                                                    Ronald
                                                    O.
                                                    Felipe,
                                                    DMD</div>
                                            </div>
                                        </div>
                                        <span class="fw-bold">DENTISTRY</span>
                                        <div style="font-size:14px;">
                                            General Dentistry, Prosthodontics, Endodontics, Surgery, Orthodontics<br>
                                            Member, Philippine Dental Association<br>
                                            Member, Quezon City Dental Chapter, Inc<br>
                                            Member, Philippine Prosthodontic Society<br>
                                            Member, Philippine Endodontic Society
                                        </div>

                                    </div>
                                </div>
                                <div class="col-4 text-end">
                                    <img src="/site-logo.png" alt="Blessed Smile Logo"
                                        style="width:120px; margin-bottom:4px;">
                                    <div class="fw-bold" style="margin-bottom:2px;">Blessed Smile<br><span
                                            style="font-size:16px;">Dental
                                            Clinic</span></div>
                                    <div style="font-size:12px; margin-bottom:0;">EST. 2005</div>
                                </div>
                            </div>
                            <div class="row mt-3 mb-2">
                                <div class="col-8">
                                    <div class="mb-2" style="display: flex; gap: 5px;">
                                        <label for="certificatePatientName" class="form-label mb-1"
                                            style="font-weight: 500;">Patient's
                                            Name:</label>
                                        <input class="form-control" type="text" name="" id="certificatePatientName"
                                            list="patientNamesDatalist"
                                            style="max-width: 220px; height: 28px; font-size: 0.95rem;">
                                    </div>
                                    <div class="mb-2" style="display: flex; gap: 5px;">
                                        <label for="certificateAddress" class="form-label mb-1"
                                            style="font-weight: 500;">Address:
                                        </label>
                                        <input class="form-control" type="text" name="" id="certificateAddress"
                                            style="max-width: 220px; height: 28px; font-size: 0.95rem;">
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="mb-2" style="display: flex; gap: 5px;">
                                        <label for="certificateDate" class="form-label mb-1"
                                            style="font-weight: 500;">Date:</label>
                                        <input class="form-control" type="date" name="" id="certificateDate"
                                            style="height: 28px; font-size: 0.95rem;">
                                    </div>
                                    <div class="mb-2" style="display: flex; gap: 5px;">
                                        <label for="certificateAge" class="form-label mb-1"
                                            style="font-weight: 500;">Age:</label>
                                        <input class="form-control" type="text" name="" id="certificateAge"
                                            style="max-width: 50px; text-align: center; height: 28px; font-size: 0.95rem;">
                                    </div>
                                </div>
                            </div>
                            <div class="row mb-4">
                                <div class="col-12">
                                    <h1 class="text-center " style="font-size: 30px;">Dental Certificate</h1>

                                    <textarea class="form-control mt-2" rows="6" placeholder="Certificate details..."
                                        style="width: 100%; min-height: 200px; font-size: 1.1rem; padding: 12px; box-sizing: border-box; line-height: 1.4;">This is to certify that [Patient Name], [Age] years old, residing at [Address], was examined and treated at Blessed Smile Dental Clinic on [Date]. The patient is advised to [rest/abstain from work/school/other instructions] for [number] days due to [reason/condition]. If you have any questions, please feel free to contact us.
                                </textarea>

                                </div>
                            </div>
                            <div class="row mt-5">
                                <div id="doctorSignatureRow"
                                    style="display: flex; justify-content: center; gap: 60px; margin-bottom: 18px;">
                                    <div style="text-align: center; display: inline-block; min-width: 220px;">
                                        <div style="font-family:serif; font-size:1.3rem; font-weight:bold;">Kristine Mae
                                            Felipe, DMD</div>
                                        <div style="font-size:15px; margin-top:4px;">LICENSE NO. : 47494</div>
                                        <div style="font-size:15px; margin-top:2px;">PTR NO.</div>
                                    </div>
                                    <div style="text-align: center; display: inline-block; min-width: 220px;">
                                        <div style="font-family:serif; font-size:1.3rem; font-weight:bold;">Ronald O.
                                            Felipe, DMD</div>
                                        <div style="font-size:15px; margin-top:4px;">LICENSE NO. : 46872</div>
                                        <div style="font-size:15px; margin-top:2px;">PTR NO.</div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-4">
                                <div class="col-12 text-center" style="font-size:15px;  margin-bottom: 50px;">
                                    <span class="fw-bold">Contact #:</span> 09209548773 / 09298031380<br>
                                    <span class="fw-bold">Email:</span> blessedsmiledentalclinic@gmail.com
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="medical-clearance" role="tabpanel" aria-labelledby="medical-clearance-tab">
                <div id="medicalClearanceTemplate">
                    <div class="document-wrapper">
                        <div id="medicalClearance" class="document-content" style="max-width:800px; margin: 0 auto;">
                            <div class="row">
                                <div class="col-8">
                                    <div class="mb-2">
                                        <div>
                                            <div class="col-7 text-left">
                                                <div style="font-family:serif; font-size:1.3rem; font-weight:bold;">
                                                    Kristine
                                                    Mae
                                                    Felipe,
                                                    DMD</div>
                                            </div>
                                            <div class="col-7 text-left">
                                                <div style="font-family:serif; font-size:1.3rem; font-weight:bold;">
                                                    Ronald
                                                    O.
                                                    Felipe,
                                                    DMD</div>
                                            </div>
                                        </div>
                                        <span class="fw-bold">DENTISTRY</span>
                                        <div style="font-size:14px;">
                                            General Dentistry, Prosthodontics, Endodontics, Surgery, Orthodontics<br>
                                            Member, Philippine Dental Association<br>
                                            Member, Quezon City Dental Chapter, Inc<br>
                                            Member, Philippine Prosthodontic Society<br>
                                            Member, Philippine Endodontic Society
                                        </div>

                                    </div>
                                </div>
                                <div class="col-4 text-end">
                                    <img src="/site-logo.png" alt="Blessed Smile Logo"
                                        style="width:120px; margin-bottom:4px;">
                                    <div class="fw-bold" style="margin-bottom:2px;">Blessed Smile<br><span
                                            style="font-size:16px;">Dental
                                            Clinic</span></div>
                                    <div style="font-size:12px; margin-bottom:0;">EST. 2005</div>
                                </div>
                                <div class="row mt-3 mb-2">
                                    <div class="col-8">
                                        <div class="mb-2" style="display: flex; gap: 5px;">
                                            <label for="certificateDate" class="form-label mb-1"
                                                style="font-weight: 500;">Date:</label>
                                            <input class="form-control" type="date" name="" id="certificateDate"
                                                style="height: 28px; font-size: 0.95rem;">
                                        </div>
                                        <div class="mb-2" style="display: flex; gap: 5px;">
                                            <label for="toDr" class="form-label mb-1" style="font-weight: 500;">To
                                                Dr. :</label>
                                            <input class="form-control" type="text" name="" id="toDr"
                                                style="max-width: 220px; height: 28px; font-size: 0.95rem;">
                                        </div>

                                    </div>
                                    <div class="col-4">

                                        <div class="mb-2" style="display: flex; gap: 5px;">
                                            <label for="certificatePhone" class="form-label mb-1"
                                                style="font-weight: 500;">Phone:</label>
                                            <input class="form-control" type="text" name="" id="certificatePhone"
                                                style="max-width: 100%; text-align: center; height: 28px; font-size: 0.95rem;">
                                        </div>
                                        <div class="mb-2" style="display: flex; gap: 5px;">
                                            <label for="certificateFax" class="form-label mb-1"
                                                style="font-weight: 500;">Fax:</label>
                                            <input class="form-control" type="text" name="" id="certificateFax"
                                                style="max-width: 100%; text-align: center; height: 28px; font-size: 0.95rem;">
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-3 mb-2">
                                    <div class="col-12">
                                        <div
                                            style="font-family:serif; font-size:1.15rem; font-weight:bold; margin-bottom:10px;">
                                            RE: REQUEST FOR MEDICAL CLEARANCE</div>
                                        <div style="margin-bottom:10px; font-size:1.05rem;"><span
                                                style="font-weight:bold;">Name of Patient:</span> <input type="text"
                                                class="form-control d-inline-block"
                                                style="width:60%; max-width:350px; display:inline-block; margin-left:8px; margin-bottom:4px;"
                                                id="clearancePatientName" list="patientNamesDatalist"></div>
                                        <div style="margin-bottom:10px; font-size:1.05rem;">I have examined the patient
                                            and
                                            recommended the following dental treatment in my office:</div>
                                        <div style="margin-bottom:10px; display: flex; justify-content: space-around;">
                                            <label style="margin-right:18px;"><input type="checkbox"
                                                    id="clearanceToothExtraction"> Tooth extraction</label>
                                            <label style="margin-right:18px;"><input type="checkbox"
                                                    id="clearanceRootCanal"> Root Canal</label>
                                            <label style="margin-right:18px;"><input type="checkbox"
                                                    id="clearanceFillings">
                                                Fillings</label>
                                            <label style="margin-right:18px;"><input type="checkbox"
                                                    id="clearanceProphylaxis"> Prophylaxis</label>
                                        </div>
                                        <div style="margin-bottom:10px; font-size:1.05rem;">Based on the medical
                                            information
                                            given to us by the above patient, it is noted that the patient was
                                            previously,
                                            or presently under your care for an existing medical condition as reported
                                            by
                                            her/him.</div>
                                        <div
                                            style="width:100%; margin-bottom:10px; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                                            <div class="flex  " style="width: 90%; font-size: 22px;">(<input type="text"
                                                    class="form-control d-inline-block"
                                                    style="width:90%; display:inline-block; text-align:center;"
                                                    id="clearanceCondition"></input>)</div>

                                            <span style="font-size:0.95rem; text-align:center;">(Brief description of
                                                medical condition as
                                                reported by patient)</span>
                                        </div>
                                        <div style="margin-bottom:10px; font-size:1.05rem;">
                                            <textarea name="" id="" style="width: 100%; border:none; height:450px;">In order for us to deliver safe and efficient dental treatment while being aware of patient's medical condition, I would like to request a brief written medical clearance to ensure that any of the above proposed treatment is permissible. Specifically, the above procedures may need local anesthetic (2% lidocaine with epinephrine) and analgesic for post operative pain. In order for us to deliver safe and efficient dental treatment while being aware of patient's medical condition, I would like to request a brief written medical clearance to ensure that any of the above proposed treatment is permissible. Specifically, the above procedures may need local anesthetic (2% lidocaine with epinephrine) and analgesic for post operative pain.
                                     
In your opinion, is there any contraindication to any of the proposed dental treatment? Finally, are there any other medical considerations of which I should be aware that the patient might not have fully disclosed to me?

If you have any questions or concerns, please do not hesitate to give me a call. Your cooperation is greatly appreciated.
</textarea>
                                        </div>

                                        <div style="margin-bottom:10px; font-size:1.05rem;">Thank you,</div>
                                        <div style="font-size:1.05rem; font-weight:bold; margin-bottom: 20px;"><input
                                                type="text" id="belowName" style="border-top: none; border-left: none;
    border-right: none;" placeholder="Name Here"></div>

                                        <div>
                                            <div
                                                style="border:1px solid #222; border-radius:4px; padding:16px; margin-bottom:18px;">
                                                <div
                                                    style="font-weight:bold; text-align:center; font-size:1.15rem; margin-bottom:8px;">
                                                    Medical Doctors Brief Notes/Recommendations:</div>
                                                <div style="margin-bottom:12px;">
                                                    <textarea rows="3"
                                                        style="width:100%; border-top: none; border-left: none;
    border-right: none; border-bottom:1px solid #222; border-radius:2px; resize:none; font-size:1rem; margin-bottom:8px;"></textarea>
                                                    <textarea rows="1"
                                                        style="width:100%; border-top: none;
    border-left: none;
    border-right: none; border-bottom:1px solid #222; border-radius:2px; resize:none; font-size:1rem; margin-bottom:8px;"></textarea>
                                                    <textarea rows="1" style="width:100%;    border-top: none;
    border-left: none;
    border-right: none; border-bottom:1px solid #222; border-radius:2px; resize:none; font-size:1rem;"></textarea>
                                                </div>
                                                <div
                                                    style="display:flex; justify-content:space-between; align-items:center; margin-top:10px;">
                                                    <span>Doctor's Signature: <span
                                                            style="display:inline-block; min-width:180px; border-bottom:1px solid #222;"></span></span>
                                                    <span>Date: <input type="date" name="patientConsentDate"
                                                            id="patientConsentDate" style="border-top: none; border-left: none;
                                                    border-right: none;"></span>
                                                </div>
                                            </div>

                                        </div>
                                        <div>
                                            <div
                                                style="border:1px solid #222; border-radius:4px; padding:16px; margin-bottom:18px;">
                                                <div
                                                    style="font-weight:bold; text-align:center; font-size:1.08rem; margin-bottom:8px;">
                                                    Patient's Consent to Authorize the Release of Medical Information
                                                </div>
                                                <div style="margin-bottom:12px; font-size:1rem;">I hereby authorize the
                                                    release my medical records as requested above:</div>
                                                <div
                                                    style="display:flex; justify-content:space-between; align-items:center; margin-top:10px;">
                                                    <span>Patient's Signature: <span
                                                            style="display:inline-block; min-width:180px; border-bottom:1px solid #222;"></span></span>
                                                    <span>Date: <input type="date" name="patientConsentDate"
                                                            id="patientConsentDate" style="border-top: none; border-left: none;
    border-right: none;"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="tab-pane fade" id="dental-case-report" role="tabpanel" aria-labelledby="dental-case-report-tab">
                <div class="document-wrapper">
                    <div class="document-content">
                        <div id="dentalCaseReportTemplate">
                            <div id="dentalCaseReport" style="max-width:850px; margin: 0 auto;">
                                <!-- Dental Case Report content goes here -->
                                <div class="row">
                                    <div class="col-8">
                                        <div class="mb-2">
                                            <div>
                                                <div class="col-7 text-left">
                                                    <div style="font-family:serif; font-size:1.3rem; font-weight:bold;">
                                                        Kristine
                                                        Mae
                                                        Felipe,
                                                        DMD</div>
                                                </div>
                                                <div class="col-7 text-left">
                                                    <div style="font-family:serif; font-size:1.3rem; font-weight:bold;">
                                                        Ronald
                                                        O.
                                                        Felipe,
                                                        DMD</div>
                                                </div>
                                            </div>
                                            <span class="fw-bold">DENTISTRY</span>
                                            <div style="font-size:14px;">
                                                General Dentistry, Prosthodontics, Endodontics, Surgery,
                                                Orthodontics<br>
                                                Member, Philippine Dental Association<br>
                                                Member, Quezon City Dental Chapter, Inc<br>
                                                Member, Philippine Prosthodontic Society<br>
                                                Member, Philippine Endodontic Society
                                            </div>

                                        </div>
                                    </div>
                                    <div class="col-4 text-end">
                                        <img src="/site-logo.png" alt="Blessed Smile Logo"
                                            style="width:120px; margin-bottom:4px;">
                                        <div class="fw-bold" style="margin-bottom:2px;">Blessed Smile<br><span
                                                style="font-size:16px;">Dental
                                                Clinic</span></div>
                                        <div style="font-size:12px; margin-bottom:0;">EST. 2005</div>
                                    </div>
                                </div>
                                <div class="editor-wrapper">
                                    <div id="editor"
                                        style="height: 500px; background: #fff !important; margin-bottom: 10px;">
                                    </div>
                                </div>
                                <div id="doctorSignatureRow"
                                    style="display: flex; justify-content: center; gap: 40px; margin-top: 10px; margin-bottom: 10px;">
                                    <div style="text-align: center; min-width: 180px;">
                                        <div style="font-family:serif; font-size:1.1rem; font-weight:bold;">Kristine
                                            Mae Felipe,
                                            DMD</div>
                                        <div
                                            style="font-size:13px; margin-top:2px; display:flex; justify-content:center; gap:4px;">
                                            <span>LICENSE <span style=" margin-left:10px;">NO.:</span></span>
                                            <span style="letter-spacing:1px;">47494</span>
                                        </div>
                                        <div style="font-size:13px; margin-top:1px;">PTR NO.</div>
                                    </div>
                                    <div style="text-align: center; min-width: 180px;">
                                        <div style="font-family:serif; font-size:1.1rem; font-weight:bold;">Ronald
                                            O. Felipe,
                                            DMD</div>
                                        <div
                                            style="font-size:13px; margin-top:2px; display:flex; justify-content:center; gap:4px;">
                                            <span>LICENSE <span style=" margin-left:10px;">NO.:</span></span>
                                            <span style="letter-spacing:1px;">46872</span>
                                        </div>
                                        <div style="font-size:13px; margin-top:1px;">PTR NO.</div>
                                    </div>
                                </div>
                                <div class="row mt-4">
                                    <div class="col-12 text-center" style="font-size:15px;  margin-bottom: 50px;">
                                        <span class="fw-bold">Contact #:</span> 09209548773 / 09298031380<br>
                                        <span class="fw-bold">Email:</span> blessedsmiledentalclinic@gmail.com
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/app.js" defer></script>
    <script src="print.js" defer></script>
    <script>
        // // Dental Case Report PDF export using jsPDF (not html2canvas)
        // document.addEventListener("DOMContentLoaded", function () {
        //     var printCaseReportBtn = document.getElementById("printCaseReportBtn");
        //     if (printCaseReportBtn) {
        //         printCaseReportBtn.addEventListener("click", function () {
        //             var caseReportDiv = document.getElementById("dentalCaseReport");
        //             var editor = document.getElementById("editor");
        //             var toolbar = document.querySelector(".ql-toolbar.ql-snow");
        //             // Save original styles
        //             var originalToolbarDisplay = toolbar ? toolbar.style.display : null;
        //             var originalEditorBorder = editor ? editor.style.border : null;
        //             var originalMaxHeight = caseReportDiv.style.maxHeight;
        //             // Apply print styles
        //             if (toolbar) toolbar.style.display = "none";
        //             if (editor) editor.style.border = "none";

        //             var jsPDFLib = window.jspdf ? window.jspdf.jsPDF : window.jsPDF;
        //             var pdf = new jsPDFLib({ unit: "pt", format: "a4" });
        //             var pageWidth = pdf.internal.pageSize.getWidth();
        //             var pageHeight = pdf.internal.pageSize.getHeight();

        //             // 1 inch = 72pt
        //             var margin = 72;
        //             // Set max-height to printable area
        //             caseReportDiv.style.maxHeight = (pageHeight - margin * 2) + "pt";

        //             pdf.html(caseReportDiv, {
        //                 x: margin,
        //                 y: margin,
        //                 width: pageWidth - margin * 2,
        //                 windowWidth: caseReportDiv.offsetWidth,
        //                 callback: function (doc) {
        //                     var fileName = "dental-case-report.pdf";
        //                     pdf.save(fileName);
        //                     // Reset styles after export
        //                     if (toolbar) toolbar.style.display = originalToolbarDisplay;
        //                     if (editor) editor.style.border = originalEditorBorder;
        //                     caseReportDiv.style.maxHeight = originalMaxHeight;
        //                 }
        //             });
        //         });
        //     }
        // });

        document.addEventListener("DOMContentLoaded", function () {
            var printCaseReportBtn = document.getElementById("printCaseReportBtn");
            if (printCaseReportBtn) {
                printCaseReportBtn.addEventListener("click", function () {
                    var caseReportDiv = document.getElementById("dentalCaseReport");
                    var editor = document.getElementById("editor");
                    var toolbar = document.querySelector(".ql-toolbar.ql-snow");

                    // Save original styles
                    var originalToolbarDisplay = toolbar ? toolbar.style.display : null;
                    var originalEditorBorder = editor ? editor.style.border : null;
                    var originalMaxHeight = caseReportDiv.style.maxHeight;

                    // Apply print styles and PDF export class
                    document.body.classList.add('pdf-export');
                    if (toolbar) toolbar.style.display = "none";
                    if (editor) editor.style.border = "none";

                    // Force black text and white background for PDF
                    caseReportDiv.style.color = '#000';
                    caseReportDiv.style.backgroundColor = '#fff';
                    if (editor) {
                        editor.style.setProperty('color', '#000', 'important');
                        editor.style.setProperty('background', '#fff', 'important');
                        editor.style.setProperty('background-color', '#fff', 'important');
                    }

                    // Force the Quill container and editor to white background
                    var quillContainer = caseReportDiv.querySelector('.ql-container');
                    var quillEditor = caseReportDiv.querySelector('.ql-editor');
                    if (quillContainer) {
                        quillContainer.style.setProperty('background', '#fff', 'important');
                        quillContainer.style.setProperty('background-color', '#fff', 'important');
                    }
                    if (quillEditor) {
                        quillEditor.style.setProperty('background', '#fff', 'important');
                        quillEditor.style.setProperty('background-color', '#fff', 'important');
                        quillEditor.style.setProperty('color', '#000', 'important');
                    }

                    // Force all text elements in case report to black
                    caseReportDiv.querySelectorAll("*").forEach(function (el) {
                        el.style.setProperty("color", "#000", "important");
                        // Force white background for all elements, not just non-transparent ones
                        el.style.setProperty("background-color", "#fff", "important");
                    });

                    var jsPDFLib = window.jspdf ? window.jspdf.jsPDF : window.jsPDF;
                    var pdf = new jsPDFLib({ unit: "pt", format: "a4" });
                    var pageWidth = pdf.internal.pageSize.getWidth();
                    var pageHeight = pdf.internal.pageSize.getHeight();

                    // 1 inch = 72pt
                    var marginTop = 72;      // 1 inch top
                    var marginBottom = 72;   // 1 inch bottom
                    var marginLeftRight = 72;

                    // Set max-height to printable area (excluding top + bottom margins)
                    caseReportDiv.style.maxHeight = (pageHeight - (marginTop + marginBottom)) + "pt";

                    pdf.html(caseReportDiv, {
                        margin: [marginTop, marginLeftRight, marginBottom, marginLeftRight], // [top, left, bottom, right]
                        autoPaging: "text", // ensures multi-page respects margins
                        width: pageWidth - marginLeftRight * 2,
                        windowWidth: caseReportDiv.offsetWidth,
                        callback: function (doc) {
                            doc.save("dental-case-report.pdf");

                            // Reset styles after export
                            document.body.classList.remove('pdf-export');
                            if (toolbar) toolbar.style.display = originalToolbarDisplay;
                            if (editor) editor.style.border = originalEditorBorder;
                            caseReportDiv.style.maxHeight = originalMaxHeight;

                            // Reset colors
                            caseReportDiv.style.color = '';
                            caseReportDiv.style.backgroundColor = '';
                            if (editor) {
                                editor.style.removeProperty('color');
                                editor.style.removeProperty('background');
                                editor.style.removeProperty('background-color');
                            }

                            // Reset Quill container and editor styles
                            var quillContainer = caseReportDiv.querySelector('.ql-container');
                            var quillEditor = caseReportDiv.querySelector('.ql-editor');
                            if (quillContainer) {
                                quillContainer.style.removeProperty('background');
                                quillContainer.style.removeProperty('background-color');
                            }
                            if (quillEditor) {
                                quillEditor.style.removeProperty('background');
                                quillEditor.style.removeProperty('background-color');
                                quillEditor.style.removeProperty('color');
                            }

                            // Reset forced colors on all elements
                            caseReportDiv.querySelectorAll("*").forEach(function (el) {
                                el.style.removeProperty("color");
                                el.style.removeProperty("background-color");
                            });
                        }
                    });

                });
            }
        });

    </script>

    <script>
        Quill.register('modules/imageResize', window.ImageResize.default);
        // Register font size style with allowed pixel values BEFORE initializing Quill
        var Size = Quill.import('attributors/style/size');
        Size.whitelist = ['10px', '12px', '14px', '16px', '18px', '24px', '32px'];
        Quill.register(Size, true);
        // Register custom fonts
        var Font = Quill.import('attributors/class/font');
        Font.whitelist = ['sans-serif', 'arial', 'timesnewroman', 'roboto', 'montserrat'];
        Quill.register(Font, true);

        const quill = new Quill('#editor', {
            theme: 'snow',
            modules: {
                toolbar: [
                    [{ 'font': ['sans-serif', 'arial', 'timesnewroman', 'roboto', 'montserrat'] }],
                    [{ 'size': ['10px', '12px', '14px', '16px', '18px', '24px', '32px', false] }],
                    ['bold', 'italic', 'underline', 'strike'],
                    [{ 'color': [] }, { 'background': [] }],
                    [{ 'list': 'ordered' }, { 'list': 'bullet' }, { 'indent': '-1' }, { 'indent': '+1' }],
                    [{ 'direction': 'rtl' }],
                    [{ 'align': [] }],
                    ['link', 'image'],
                ],
                imageResize: {
                    modules: ['Resize', 'DisplaySize', 'Toolbar']
                }
            }
        });

        // Auto-adjust height
        quill.on('text-change', function () {
            const editor = document.querySelector('#editor .ql-editor');
            const container = document.getElementById('editor');

            container.style.height = "auto"; // reset
            container.style.height = editor.scrollHeight + "px";
        });

        // Make images draggable inside the editor and prevent highlight on drag
        function enableImageDragging() {
            const editor = document.querySelector('#editor .ql-editor');
            if (!editor) return;
            editor.querySelectorAll('img').forEach(img => {
                img.setAttribute('draggable', 'true');
                img.addEventListener('dragstart', function (e) {
                    e.dataTransfer.setData('text/plain', '');
                    window.draggedImage = img;
                    // Prevent highlight/selection
                    img.style.userSelect = 'none';
                });
                img.addEventListener('selectstart', function (e) {
                    e.preventDefault();
                });
            });
            editor.addEventListener('dragover', function (e) {
                e.preventDefault();
            });
            editor.addEventListener('drop', function (e) {
                e.preventDefault();
                const dragged = window.draggedImage;
                if (dragged) {
                    // Get drop position
                    const range = document.caretRangeFromPoint(e.clientX, e.clientY);
                    if (range) {
                        // Remove the image from its old position
                        dragged.parentNode.removeChild(dragged);
                        // Insert at new position
                        range.insertNode(dragged);
                        window.draggedImage = null;
                        quill.update();
                    }
                }
            });
        }
        quill.on('text-change', enableImageDragging);
        window.addEventListener('load', enableImageDragging);

        // Make images draggable inside the editor
        function enableImageDragging() {
            const editor = document.querySelector('#editor .ql-editor');
            if (!editor) return;
            editor.querySelectorAll('img').forEach(img => {
                img.setAttribute('draggable', 'true');
                img.addEventListener('dragstart', function (e) {
                    e.dataTransfer.setData('text/plain', '');
                    window.draggedImage = img;
                });
            });
            editor.addEventListener('dragover', function (e) {
                e.preventDefault();
            });
            editor.addEventListener('drop', function (e) {
                e.preventDefault();
                const dragged = window.draggedImage;
                if (dragged) {
                    // Get drop position
                    const range = document.caretRangeFromPoint(e.clientX, e.clientY);
                    if (range) {
                        // Remove the image from its old position
                        dragged.parentNode.removeChild(dragged);
                        // Insert at new position
                        range.insertNode(dragged);
                        window.draggedImage = null;
                        quill.update();
                    }
                }
            });
        }
        quill.on('text-change', enableImageDragging);
        window.addEventListener('load', enableImageDragging);

    </script>
    <script>
        // Get today's date in YYYY-MM-DD format
        const today = new Date().toISOString().split('T')[0];

        // Select all date inputs and set their value
        document.querySelectorAll('input[type="date"]').forEach(el => {
            el.value = today;
        });

        // Wait for Firebase to be initialized by app.js (no need to redeclare config)
    </script>

    <script>
        // Ensure Dental Case Report tab activates even if another script interferes.
        // This uses Bootstrap's Tab API to programmatically show the pane when clicked.
        document.addEventListener('DOMContentLoaded', function () {
            try {
                var dentalTabBtn = document.getElementById('dental-case-report-tab');
                if (dentalTabBtn && window.bootstrap && typeof window.bootstrap.Tab === 'function') {
                    var bsTab = new bootstrap.Tab(dentalTabBtn);
                    dentalTabBtn.addEventListener('click', function (e) {
                        // Let Bootstrap handle it first; then force-show as a fallback after a short tick.
                        setTimeout(function () {
                            var pane = document.getElementById('dental-case-report');
                            if (pane && !pane.classList.contains('show')) {
                                // Hide other panes and show this one
                                document.querySelectorAll('#prescriptionTabsContent .tab-pane').forEach(function (p) {
                                    p.classList.remove('show', 'active');
                                });
                                pane.classList.add('show', 'active');
                            }
                        }, 50);
                    });
                }
            } catch (err) {
                console && console.error && console.error('Dental tab activation helper error:', err);
            }
        });
    </script>

</body>

</html>