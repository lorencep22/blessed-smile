<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transactions</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <style>
        .modal-dialog.modal-dialog-centered {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Hide number input spinners for all browsers */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type=number] {
            -moz-appearance: textfield;
        }
    </style>
</head>

<body style="height: 100%;" id="patients-page">

    <div class="container mt-4">
        <div class="row mb-2">
            <div class="col-12 d-flex gap-2 justify-content-between align-items-center">
                <h2 class="fw-bold text-primary">Transactions List</h2>
                <div class="d-flex gap-2">
                    <div class="input-group" style="max-width:600px; margin-left: auto;">
                        <div class="input-group" style="max-width: 600px;">
                            <select class="form-select" id="dateFilterSelect" style="max-width:180px;">
                                <option value="thisWeek">This Week</option>
                                <option value="prevWeek">Previous Week</option>
                                <option value="thisMonth">This Month</option>
                                <option value="prevMonth">Previous Month</option>
                                <option value="thisYear">This Year</option>
                                <option value="custom">Custom Range</option>
                            </select>
                            <input type="date" class="form-control d-none" id="customStartDate"
                                style="max-width:140px;">
                            <span class="input-group-text d-none" id="toLabel">to</span>
                            <input type="date" class="form-control d-none" id="customEndDate" style="max-width:140px;">
                            <button type="button" class="btn btn-primary" id="filterDateBtn">Filter</button>
                        </div>
                    </div>

                    <button type="button" class="btn btn-primary py-2 px-3" id="reloadProceduresBtn"
                        title="Reload Procedures" style="height: 38px;">
                        <i class="fa fa-rotate-right"></i>
                    </button>
                </div>
            </div>
            <div class="card shadow-sm">
                <!-- <div class="card-header bg-primary text-white">
                <h4 class="mb-0">Procedures Done to Patients</h4>
            </div> -->
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>DATE</th>
                                    <th>TOOT NO./S</th>
                                    <th>Procedure</th>
                                    <th>AMOUNT</th>
                                    <th>BALANCE</th>
                                    <th>STATUS</th>
                                </tr>
                            </thead>
                            <tbody id="transactionsTableBody">
                                <!-- Transaction rows will be rendered here by JS -->
                            </tbody>
                        </table>
                    </div>

                </div>
            </div>
        </div>
        <!-- Add Procedure Modal -->

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
        <script src="/app.js" defer></script>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const reloadBtn = document.getElementById('reloadProceduresBtn');
                if (reloadBtn) {
                    reloadBtn.addEventListener('click', function () {
                        location.reload();
                    });
                }

                // Date filter logic
                const dateFilterSelect = document.getElementById('dateFilterSelect');
                const customStartDate = document.getElementById('customStartDate');
                const customEndDate = document.getElementById('customEndDate');
                const toLabel = document.getElementById('toLabel');

                if (dateFilterSelect) {
                    dateFilterSelect.addEventListener('change', function () {
                        if (this.value === 'custom') {
                            customStartDate.classList.remove('d-none');
                            customEndDate.classList.remove('d-none');
                            toLabel.classList.remove('d-none');
                        } else {
                            customStartDate.classList.add('d-none');
                            customEndDate.classList.add('d-none');
                            toLabel.classList.add('d-none');
                        }
                    });
                }
            });
        </script>
        <script>

            document.addEventListener('DOMContentLoaded', function () {
                // Pagination variables
                let proceduresData = [];
                // Fetch all procedures and store in array
                function fetchProcedures() {
                    if (window.proceduresCollection) {
                        window.proceduresCollection.orderBy('date', 'desc').get().then(snapshot => {
                            proceduresData = [];
                            snapshot.forEach(doc => {
                                const p = doc.data();
                                proceduresData.push({ id: doc.id, ...p });
                            });
                            totalPages = Math.max(1, Math.ceil(proceduresData.length / pageSize));
                            renderProceduresTable();
                            updatePaginationControls();
                        });
                    }
                }
                fetchProcedures();
            });
        </script>

</body>

</html>